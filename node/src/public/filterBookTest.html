<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
      .results {
  max-width: 900px;
}

.book-card {
  display: flex;
  gap: 12px;
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
}

.book-card:hover {
  background: #f7f7f7;
}

.book-card img {
  width: 80px;
  height: 110px;
  object-fit: cover;
  border-radius: 6px;
}

.book-meta h4 {
  margin: 0;
  font-size: 16px;
}

.book-meta p {
  margin: 4px 0;
  color: #666;
}

.source {
  font-size: 12px;
  color: #999;
}
.skeleton-img {
  width: 80px;
  height: 110px;
  background: #ddd;
  border-radius: 6px;
}

.skeleton-text {
  flex: 1;
  height: 60px;
  background: linear-gradient(90deg, #ddd, #eee, #ddd);
  animation: shimmer 1.2s infinite;
}

@keyframes shimmer {
  0% { background-position: -200px; }
  100% { background-position: 200px; }
}

    </style>
</head>
<body>
    <input id="bookSearch" placeholder="Search title or paste bookQidâ€¦" />
    <div id="results" class="results"></div>
</body>
<script>
    const API = "https://thebooksourcings.onrender.com/api/books/search";
const input = document.getElementById("bookSearch");
const results = document.getElementById("results");

let timer;

input.addEventListener("input", () => {
  clearTimeout(timer);
  const q = input.value.trim();
  if (!q) {
    results.innerHTML = "";
    return;
  }

  timer = setTimeout(() => fetchBooks(q), 300);
});

async function fetchBooks(q) {
  const res = await fetch(`${API}?q=${encodeURIComponent(q)}`);
  const data = await res.json();
  renderBooks(data);
}

function renderBooks(books) {
  results.innerHTML = "";

  books.forEach(b => {
    const div = document.createElement("div");
    div.className = "book-card";
    div.innerHTML = `
      <img src="${b.cover || "/img/noCoverFound.png"}" />
      <div>
        <h4>${b.title}</h4>
        <p>${b.authors.join(", ")}</p>
        <small>${b.source}</small>
      </div>
    `;

    div.onclick = () => {
      // Redirect to detail page
      window.location.href = `/book/${b.bookQid}`;
    };

    results.appendChild(div);
  });
}
function showSkeleton() {
  results.innerHTML = Array.from({ length: 5 })
    .map(() => `
      <div class="book-card">
        <div class="skeleton-img"></div>
        <div class="skeleton-text"></div>
      </div>
    `)
    .join("");
}
const cache = new Map();

async function fetchBooks(q) {
  if (cache.has(q)) {
    renderBooks(cache.get(q));
    return;
  }

  showSkeleton();

  const res = await fetch(`${API}?q=${encodeURIComponent(q)}`);
  const data = await res.json();

  cache.set(q, data);
  renderBooks(data);
}

</script>
</html>