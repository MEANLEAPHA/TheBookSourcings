<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
      .results {
  max-width: 900px;
}

.book-card {
  display: flex;
  gap: 12px;
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
}

.book-card:hover {
  background: #f7f7f7;
}

.book-card img {
  width: 80px;
  height: 110px;
  object-fit: cover;
  border-radius: 6px;
}

.book-meta h4 {
  margin: 0;
  font-size: 16px;
}

.book-meta p {
  margin: 4px 0;
  color: #666;
}

.source {
  font-size: 12px;
  color: #999;
}
.skeleton-img {
  width: 80px;
  height: 110px;
  background: #ddd;
  border-radius: 6px;
}

.skeleton-text {
  flex: 1;
  height: 60px;
  background: linear-gradient(90deg, #ddd, #eee, #ddd);
  animation: shimmer 1.2s infinite;
}

@keyframes shimmer {
  0% { background-position: -200px; }
  100% { background-position: 200px; }
}
#book-search-results {
  display: flex;
  gap: 16px;
  margin-top: 20px;
  padding: 12px;
  border: 1px solid #eee;
  border-radius: 8px;
}

#img-book {
  width: 140px;
  height: 200px;
  object-fit: cover;
  border-radius: 6px;
}

#book-title {
  font-weight: bold;
  font-size: 18px;
}

#book-author {
  color: #555;
}

#book-des {
  color: #666;
  margin-top: 8px;
}

    </style>
</head>
<body>
    <input id="bookSearch" placeholder="Search title or paste bookQidâ€¦" />
    <button id="pasteBtn" type="button">ðŸ“‹ Paste</button>
    <div id="results" class="results"></div>
    <div id="book-search-results">
              <div id="img-book-wrapper">
                 <img src="" id="img-book">
              </div>
              <div id="book-info-wrapper">
                 <p id="book-title"></p>
                 <p id="book-author"></p>
                 <p id="book-des"></p>
              </div>
          </div>
</body>
<script>

  const pasteBtn = document.getElementById("pasteBtn");

pasteBtn.addEventListener("click", async () => {
  try {
    const text = await navigator.clipboard.readText();
    if (!text) return;

    input.value = text.trim();
    input.dispatchEvent(new Event("input")); // ðŸ”¥ trigger search
  } catch (err) {
    alert("Clipboard access denied");
  }
});

    const API = "https://thebooksourcings.onrender.com/api/books/search";
const input = document.getElementById("bookSearch");
const results = document.getElementById("results");

let timer;
let selectedBook = null;

input.addEventListener("input", () => {
  clearTimeout(timer);
  const q = input.value.trim();
  if (!q) {
    results.innerHTML = "";
    return;
  }

  timer = setTimeout(() => fetchBooks(q), 300);
});

async function fetchBooks(q) {
  const res = await fetch(`${API}?q=${encodeURIComponent(q)}`);
  const data = await res.json();
  renderBooks(data);
}

function renderBooks(books) {
  results.innerHTML = "";

  books.forEach(b => {
    const div = document.createElement("div");
    div.className = "book-card";
    div.innerHTML = `
      <img src="${b.cover || "/img/noCoverFound.png"}" />
      <div class="book-meta">
        <h4>${b.title}</h4>
        <p>${b.authors.join(", ")}</p>
        <small class="source">${b.source}</small>
      </div>
    `;

    div.onclick = () => selectBook(b);
    results.appendChild(div);
  });
}

function showSkeleton() {
  results.innerHTML = Array.from({ length: 5 })
    .map(() => `
      <div class="book-card">
        <div class="skeleton-img"></div>
        <div class="skeleton-text"></div>
      </div>
    `)
    .join("");
}
const cache = new Map();

async function fetchBooks(q) {
  if (cache.has(q)) {
    renderBooks(cache.get(q));
    return;
  }

  showSkeleton();

  const res = await fetch(`${API}?q=${encodeURIComponent(q)}`);
  const data = await res.json();

  cache.set(q, data);
  renderBooks(data);
}
function fillBookPreview(book) {
  const img = document.getElementById("img-book");
  const title = document.getElementById("book-title");
  const author = document.getElementById("book-author");
  const des = document.getElementById("book-des");

  img.src = book.cover || "/img/noCoverFound.png";
  img.alt = book.title || "Book cover";

  title.textContent = book.title || "Untitled";

  author.textContent = book.authors?.length
    ? book.authors.join(", ")
    : "Unknown author";

  des.textContent = book.description
    ? book.description.slice(0, 300) + (book.description.length > 300 ? "â€¦" : "")
    : "No description available.";
    results.innerHTML = "";
}
function selectBook(book) {
  selectedBook = book; // âœ… store for DB

  // ðŸ”¥ Update input value (for saving)
  input.value = book.bookQid; 
  // OR use title if you prefer:
  // input.value = book.title;

  // Fill preview panel
  fillBookPreview(book);

  // Hide results ONLY after selection
  results.innerHTML = "";
}

</script>
</html>