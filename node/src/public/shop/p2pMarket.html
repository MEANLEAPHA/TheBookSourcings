<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <script src="https://kit.fontawesome.com/ec7a51a641.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://kit.fontawesome.com/ec7a51a641.js" crossorigin="anonymous"></script>
        <link rel="icon" href="assets/img/ThebooksorucingsIcon-removebg-preview.png">
        <link rel="stylesheet" href="../components/ui/global.css">
      
    </head>
    <body>
        <header id="header">
            <div id="headerLeft"> 
                <i class="fa-solid fa-bars"></i>
                <a href="#top"><img src="../assets/img/TheBookSourcingLogo-removebg-preview.png" alt="RentWell-Logo" id="logo"></a>
            </div>
            <div id="headerMiddle">
                <input type="text" placeholder="Search" id="searchTBS">
                <i class="fa-solid fa-magnifying-glass" id="searchIcon"></i>
            </div>
            <div id="headerRight">
                <i class="fa-solid fa-magnifying-glass" id="searchIcons"></i>
                <div id="create">
                <a href="uploadSale.html" style="display: flex;align-items: center;gap: 5px;margin: 0;">
                    <div>Sell book</div>
                </a>
                </div>
                <i class="fa-regular fa-bell"></i>
                <img src="../assets/img/pf.jpg" class="userPf" alt="user" class="dropdown-item" style='color: rgb(60, 60, 60);font-family: "Reenie Beanie", cursive;font-weight: 599;font-size: large;' id="liveToastBtn">
            </div>
        </header>
        <div id="phoneSearch">
            <div id="phoneSearchLeft"><i class="fa-solid fa-arrow-left"></i></div>
            <div id="headerMiddle2">
                    <input type="text" placeholder="Search" id="searchTBS">
                    <i class="fa-solid fa-magnifying-glass" id="searchIcon"></i>
            </div>
        </div>
        <main>
            <div class="smallCollape">
                <ul>
                    <li><i class="fa-solid fa-house"></i></li>
                    <li><i class="fa-solid fa-newspaper"></i></li>
                    <li><i class="fa-solid fa-shop"></i></li>
                    <li><i class="fa-solid fa-users"></i></li>
                    <li><i class="fa-solid fa-gamepad"></i></li>
                    <li><i class="fa-solid fa-circle-user"></i></li>
                </ul>
            </div>
            <div class="collapse">
                <ul id="u1">    
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-house"></i>Home</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-newspaper"></i>Articles</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-shop"></i>Market Place</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-users"></i>Community</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-gamepad"></i>Games</a></li>
                </ul>
                <ul id="u2">    
                    <li class="liTop"><Big>You > </Big></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-clock-rotate-left"></i>History</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-lines-leaning"></i>Your Library</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-book"></i>Your Book</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-bookmark"></i>Favorite</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-thumbs-up"></i>Liked</a></li>
                </ul>
                <ul id="u3">    
                    <li class="liTop"><Big>Following</Big></li>
                </ul>
                <div class="following">
                    <div class="followingChild"><img src="dog.png" class="followingPf"><p class="followingName">Golden Ramsy</p></div>
                    <div class="followingChild"><img src="dog.png" class="followingPf"><p class="followingName">Morgen Housel</p></div>
                    <div class="followingChild"><img src="dog.png" class="followingPf"><p class="followingName">Yuval Noah Harari</p></div>
                    <div class="followingChild"><img src="dog.png" class="followingPf"><p class="followingName">Meanleap Ha</p></div>
                    <div class="followingChild"><img src="dog.png" class="followingPf"><p class="followingName">Yuval Noah Harari</p></div>
                    <li id="allFollowing"><a href="userBook/yourBookTest.html"><i class="fa-solid fa-list"></i>All Following</a></li>
                    <li id="showMoreFollow"><a><i class="fa-solid fa-chevron-down"></i>Show More</a></li>
                    <li id="showLessFollow"><a><i class="fa-solid fa-chevron-up"></i>Show Less</a></li>
                </div>
                <ul id="u4">    
                    <li class="liTop"><Big>Explore</Big></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-masks-theater"></i>Novel</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-mask"></i>Comic Book</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-user-ninja"></i>Manga</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-lightbulb"></i>Literature</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-feather-pointed"></i>Poetry</a></li>
                </ul>
                <ul id="u5">    
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-gear"></i>Settings</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-flag"></i>Report</a></li>
                    <li><a href="userBook/yourBookTest.html"><i class="fa-solid fa-circle-question"></i>Help</a></li>
                    <li class="feedBackBtn2"><a href="userBook/yourBookTest.html"><i class="fa-solid fa-comment-dots"></i>Send Feedback</a></li>
                </ul>
                <ul id="uLast">
                    <li>About</li>
                    <li>Contact</li>
                    <li>Advertise</li>
                    <li>Terms</li>
                    <li>Privacy</li>
                    <li>Policy</li>
                </ul>
                <ul id="uLast2">
                    <li>
                    <a>
                        © 2025 TheBookSourcing. All rights reserved
                    </a>
                    </li>
                </ul>
            </div>
            <div class="content">
                <!-- The filter option-->
                <div class="nav-wrapper">
                    <form id="filterForm" class="row g-3 align-items-center">
                        <!-- 💰 Price Range -->
                        <div class="col-md-4 col-sm-6">
                            <div class="input-group">
                            <input
                                type="number"
                                id="priceMin"
                                class="form-control"
                                placeholder="Min Price"
                                min="0"
                            />
                            <span class="input-group-text">-</span>
                            <input
                                type="number"
                                id="priceMax"
                                class="form-control"
                                placeholder="Max Price"
                                min="0"
                            />
                            </div>
                        </div>

                        <!-- 🏷️ Sale Type -->
                         
                        <div class="col-md-2 col-sm-6">
                            <select id="saleType" class="form-select">
                            <option value="">All Sale Types</option>
                            <option value="normal">Normal Sale</option>
                            <option value="discount">Discount Sale</option>
                            <option value="free">Free</option>
                            </select>
                        </div>

                        <!-- 💸 Discount Type -->
                        <div class="col-md-2 col-sm-6">
                            <select id="discountType" class="form-select">
                            <option value="">All Discounts</option>
                            <option value="percent">Percentage</option>
                            <option value="fixed">Fixed Price</option>
                            </select>
                        </div>

                        <!-- 🧾 Book Type -->
                        <div class="col-md-2 col-sm-6">
                            <select id="bookType" class="form-select">
                            <option value="">All Book Types</option>
                            <option value="ebook">E-Book</option>
                            <option value="paper">Physical</option>
                            </select>
                        </div>

                        <!-- 🎯 Apply Filter -->
                        <div class="col-md-1 col-sm-6 text-end">
                            <button type="submit" class="btn btn-primary w-100">
                            <i class="fa-solid fa-filter"></i>
                            </button>
                        </div>
                    </form>  
                </div>
                <!-- Sale book will display here  -->
                <div id="BookContent"></div>
            </div>
        </main>

        <!-- account tool collapse -->
    <div class="toast-container position-fixed  end-0 p-3">
      <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" >
        <div class="toast-header">
            <img src="dog.png"  class="userPf">
            <div class="userDetails">
              <p>Name</p>
              <p>@Nickname</p>
              <a href="#" style="color: #275791;">View channel</a>
          </div>
        </div>
        <div class="toast-header">
          <a href="#"><i class="fa-solid fa-gear"></i> Settings</a>
        </div>
        <div class="toast-header" id="themeSwitchSection">
            <button class="theme-switch">
              <i class="fa-solid fa-sun"></i>
              <i class="fa-solid fa-moon"></i>
            </button>
            <p id="theme-switch-word" class="theme-switch">
              <span class="fa-sun-word" >Light mode</span>
              <span class="fa-moon-word" >Dark mode</span>
            </p>
        </div>
        <div class="toast-header">
          <a href="#"><i class="fa-solid fa-circle-question"></i> Help</a>
        </div>
        <div class="toast-header"  >
          <a class="feedBackBtn2"><i class="fa-solid fa-comment-dots"></i> Feedback</a>
        </div>
        <div class="toast-body " >
          <a href="userSign/login.html"><i class="fa-solid fa-arrow-right-from-bracket"></i> <span>Login</span></a>
        </div>
      </div>
    </div>
    <!-- feedback collapse -->
    <div class="toast-containers w-500">
      <div id="liveToast2" class="toast" role="alert" aria-live="assertive" aria-atomic="true" >
        <div class="toast-header">
            <div>Send Feedback to TheBookSourcing</div>
            <button type="button" data-bs-target="#liveToast2" data-bs-dismiss="toast" aria-label="Close" id="btnCloseFBToast"><i class="fa-solid fa-arrow-right"></i></button>
        </div>
        <div class="toast-body">
          <form action="">
            <label> Please give us your feedback (required)</label>
            <input type="text" name="feedbackInput" required id="feedbackInput">
            <br>
            <br>
            <label >A screenshot will help us to understand more about your feedback (optional)</label>
            <br>
            <label class="custom-file">
              <input type="file" id="fileUpload">
              <span>  <i class="fa-solid fa-camera"></i> Capture screenshot</span>
            </label>
            <div>
              <img src="camera.png" id="screenshot" >
            </div>
            <br>
            <div id="allowEmailUpdate">
              <input type="checkbox" name="" id=""><label>We may email you for more updates</label>
            </div>
            <p id="smallWarning" ><i class="fa-solid fa-circle-exclamation text-warning" ></i> Please do not include any sensitive information! Sensitive information is any data that should be protected. Please do not include passwords, credit card numbers, or personal detail.</p>
            <button type="submit" id="feedbackSubmit" name="feedbackSubmit">Submit</button>
          </form>
        </div>
      </div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const filterForm = document.getElementById("filterForm");
    const BookContent = document.getElementById("BookContent");

    // 🌐 API base (adjust path if needed)
    const API_URL = "/displaySaleBook";

    // 🧩 Fetch and display books
    async function fetchBooks(filters = {}) {
    try {
        const queryString = new URLSearchParams(filters).toString();
        const res = await fetch(`${API_URL}?${queryString}`);
        const data = await res.json();

        if (!data.Result || !data.books) {
        BookContent.innerHTML = `<p class="text-muted text-center mt-3">No books found.</p>`;
        return;
        }

        // 🎨 Render book cards
        renderBooks(data.books);
    } catch (err) {
        console.error("Error fetching books:", err);
        BookContent.innerHTML = `<p class="text-danger text-center mt-3">Failed to load books.</p>`;
    }
    }

    // 🧱 Render books in cards
    function renderBooks(books) {
    BookContent.innerHTML = books
        .map((book) => {
        const img = book.bookImg || (book.imgPreview?.[0] ?? "https://via.placeholder.com/150");
        const discountTag =
            book.discount_type && book.discount_price
            ? `<span class="badge bg-danger ms-2">${book.discount_type === "percent" ? `-${book.discount_price}%` : `-${book.discount_price}$`}</span>`
            : "";
        const saleType =
            book.sale_type === "free"
            ? `<span class="badge bg-success ms-2">Free</span>`
            : book.sale_type === "discount"
            ? `<span class="badge bg-warning text-dark ms-2">Discount</span>`
            : "";

        return `
            <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100 shadow-sm border-0">
                <div class="ratio ratio-1x1">
                <img src="${img}" class="card-img-top rounded-top" alt="${book.title}">
                </div>
                <div class="card-body">
                <h6 class="fw-bold text-truncate">${book.title || "Untitled"} ${discountTag} ${saleType}</h6>
                <p class="text-muted small mb-1">${book.book_type?.toUpperCase() || "Unknown Type"}</p>
                <p class="mb-0">
                    ${book.price ? `<span class="fw-bold text-primary">$${book.price}</span>` : ""}
                    ${book.original_price && book.original_price > book.price
                    ? `<small class="text-decoration-line-through text-muted ms-2">$${book.original_price}</small>`
                    : ""}
                </p>
                </div>
            </div>
            </div>
        `;
        })
        .join("");
    }

    // 🧮 Handle form submission
    filterForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const filters = {
        minPrice: document.getElementById("priceMin").value,
        maxPrice: document.getElementById("priceMax").value,
        saleType: document.getElementById("saleType").value,
        discountType: document.getElementById("discountType").value,
        bookType: document.getElementById("bookType").value,
    };

    fetchBooks(filters);
    });

    // 🚀 Load all books on first load
    fetchBooks();
    });
    </script>
    <script src="../assets/js/index/darkmode.js" defer></script>
    <script src="../assets/js/index/collapseResponsive.js"></script>
    <script src="../assets/js/index/followingAcc.js"></script>
    <script src="../assets/js/index/accountToast.js"></script>
    <script src="../assets/js/index/navNewFeed.js"></script>
    <script src="../assets/js/index/feedbackToast.js"></script>
    <script src="../assets/js/index/headerSearch.js"></script>
    </body>
</html>