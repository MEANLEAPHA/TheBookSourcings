<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .post{
            width: 50%;
            height: auto;
            padding: 10px 20px 10px 20px;
            margin: auto;
            padding-left: 10px;
            border-radius: 15px;
            box-shadow: 0px 0px 3px rgba(86, 86, 86, 0.144);
        }
       
        
         .post .post-header{
            width: 100%;
            display: flex;
            padding: 5px;
            gap: 15px;
            position: relative;
            
        }
        .userProfile{
            width: 55px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
        }
        /* .post-header-child-right{


        } */
         .username{
            font-family: monospace;
            margin: 0;
            font-size: large;
         }
         .postAt{
            color: gray;
            opacity: 0.8;
            font-size: small;
            font-family: monospace;
            margin: 0;
         }
         .absolute-top-right{
            font-size: large;
            color: rgb(0, 0, 0);
            
            position: absolute;
            top: 5px;
            right: 15px;
            
         }
         .post .post-body{
            width: 100%;
            padding: 5px;
         }
         .post-text{
            font-family: sans-serif;
            margin: 0;
         }
        
          .post-thumbnail {
            position: relative;
            width: 100%;
            height: 350px;
            margin: auto;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            }



            .post-thumbnail-img {
            position: relative;
            z-index: 1;
            height: 100%;
            object-fit: contain; 
            }

             .post .post-body .post-media-count{
            
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin: 10px;
            font-family: sans-serif;
        
            
            font-size: 14px;
            opacity: 0.9;
            padding: 0;
         }
         .post-media-count div{
            margin: 0;
            padding: 0;
         }
         .post-media-count div span{
            padding: 0;
            margin: 0;
         }
         .post-media-count-child-right{
            display: flex;
            gap: 25px;
         }
         .post-hr{
            color: gainsboro;
            background-color: gainsboro;
            opacity: 0.3;
         }
         .post-media-button{
            display: flex;
            border-top: 1px gainsboro solid;
            justify-content: space-between;
            padding: 0;
           
            margin: 0;
         }
         .media-btn{
            width: calc(100%/3.06);
            padding: 20px;
            margin: 0;
            background:none;
            border: none;
            cursor: pointer;
            text-align: center;
            display: flex;
            justify-content: center;
            gap: 5px;
            
         }
         .media-btn span{
            margin-top: 2px;
             color:gray;
         }
         .media-btn:hover{
            background-color: gainsboro;
         }
         .fa-solid{
            font-size: large;
            color:gray;
         }
          @media screen and (max-width: 768px) {
              .post{
            width: 90%;
        }
    }
    </style>
</head>
<body>
    <div class="post">
        <div class="post-header">
            <img src="../../public/assets/img/pf.jpg" alt="user-profile" class="userProfile"> <!--will get the user PF by decoded later-->
            <div class="post-header-child-right">
                <p class="username">Username</p> <!--will get the username by decoded later-->
                <span class="postAt">4 days ago</span> <!--This is msg.createFormNow-->
            </div>
            <i class="fa-solid fa-ellipsis absolute-top-right"></i> <!-- This is the DROPDOWN MENU logic (Owner will see edit,delete and rport. other user see only report when click)-->
        </div>
        <div class="post-body">
            <p class="post-text">
                Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aliquid ipsa quaerat quos iste vitae porro, expedita cupiditate magni maxime dolorem. Dolore ad similique perspiciatis cupiditate minus incidunt nam ut odio.
            </p> <!--This is msg.message-->
            <div class="post-thumbnail">
                <img src="../../public//assets//img/pf.jpg" class="post-thumbnail-img">
            </div><!--This is post-thumbnail is where the logic img or video should display-->
            <div class="post-media-count">
                <div>
                    <p><span class="post-like-count">120 </span>Likes</p><!--The post-like-count is the number total which query from the community.like_count-->
                </div>
                <div class="post-media-count-child-right">
                    <p><span class="post-comment-count">5 </span> comments</p><!--The post-comment-count is the number total which query from the community.comment_count-->
                    <p><span class="post-repost-count">8 </span> reposts</p><!--The post-repost-count is the number total which query from the community.repost_count-->
                </div>
            </div>
            <div class="post-media-button">
                <button class="likeBtn media-btn"><i class="fa-solid fa-heart"></i> <span>Like</span></button><!--This is the like button that toggle when like go back gray when display so normal is gary before click-->
                <button class="likeBtn media-btn"><i class="fa-solid fa-comment"></i> <span>Comment</span></button><!--This is the comment button when user click it i want user to go to page aboutPost.html?post_id=${msg.message_id} so which mean this button hold href and also the message_id(mean post id that will user to query again to displaya lager comment this comment logic will working later)-->
                <button class="likeBtn media-btn"><i class="fa-solid fa-share-from-square"></i> <span>Repost</span></button><!--thay button will working last but just set dataset or i need the button to hold message_id first-->
            </div>
        </div>    
    </div>
</body>
</html>
<script>
    function displayMessage(msg) {
  const div = document.createElement("div");
  div.className = "post";
  div.dataset.id = msg.message_id;

  // --- POST HEADER ---
  const header = document.createElement("div");
  header.className = "post-header";

  const profileImg = document.createElement("img");
  profileImg.src = msg.profile_url || "../../public/assets/img/pf.jpg"; // placeholder
  profileImg.alt = "user-profile";
  profileImg.className = "userProfile";

  const headerRight = document.createElement("div");
  headerRight.className = "post-header-child-right";
  headerRight.innerHTML = `
    <p class="username">${msg.username || "Unknown"}</p>
    <span class="postAt">${msg.createFormNow || "just now"}</span>
  `;

  // Dropdown menu
  const dropdownWrapper = document.createElement("div");
  dropdownWrapper.className = "dropdown absolute-top-right";

  const ellipsisBtn = document.createElement("i");
  ellipsisBtn.className = "fa-solid fa-ellipsis";
  ellipsisBtn.setAttribute("data-bs-toggle", "dropdown");
  ellipsisBtn.style.cursor = "pointer";

  const dropdownMenu = document.createElement("ul");
  dropdownMenu.className = "dropdown-menu";
  if (msg.memberQid === userMemberQid) {
    dropdownMenu.innerHTML = `
      <li><a class="dropdown-item edit-option" href="#">Edit</a></li>
      <li><a class="dropdown-item delete-option" href="#">Delete</a></li>
      <li><a class="dropdown-item report-option" href="#">Report</a></li>
    `;
  } else {
    dropdownMenu.innerHTML = `
      <li><a class="dropdown-item report-option" href="#">Report</a></li>
    `;
  }
  dropdownWrapper.appendChild(ellipsisBtn);
  dropdownWrapper.appendChild(dropdownMenu);

  header.appendChild(profileImg);
  header.appendChild(headerRight);
  header.appendChild(dropdownWrapper);

  // --- POST BODY ---
  const body = document.createElement("div");
  body.className = "post-body";

  if (msg.message) {
    const textP = document.createElement("p");
    textP.className = "post-text";
    textP.textContent = msg.message;
    body.appendChild(textP);
  }

  // Media
  if (msg.media_url && msg.media_type) {
    const mediaWrapper = document.createElement("div");
    mediaWrapper.className = "post-thumbnail";
    const mediaEl = document.createElement(msg.media_type === "image" ? "img" : "video");
    mediaEl.className = "post-thumbnail-img";
    mediaEl.src = msg.media_url;
    if (msg.media_type === "video") mediaEl.controls = true;
    mediaWrapper.appendChild(mediaEl);
    body.appendChild(mediaWrapper);
  }

  // Like / comment / repost counts
  const counts = document.createElement("div");
  counts.className = "post-media-count";
  counts.innerHTML = `
    <div>
      <p><span class="post-like-count">${msg.like_count || 0}</span> Likes</p>
    </div>
    <div class="post-media-count-child-right">
      <p><span class="post-comment-count">${msg.comment_count || 0}</span> comments</p>
      <p><span class="post-repost-count">${msg.repost_count || 0}</span> reposts</p>
    </div>
  `;
  body.appendChild(counts);

  // --- BUTTONS ---
  const btnRow = document.createElement("div");
  btnRow.className = "post-media-button";

  // Like btn
  const likeBtn = document.createElement("button");
  likeBtn.className = "likeBtn media-btn";
  likeBtn.dataset.id = msg.message_id;
  likeBtn.innerHTML = `<i class="fa-solid fa-heart"></i> <span>Like</span>`;

  // Comment btn
  const commentBtn = document.createElement("button");
  commentBtn.className = "commentBtn media-btn";
  commentBtn.dataset.id = msg.message_id;
  commentBtn.innerHTML = `<i class="fa-solid fa-comment"></i> <span>Comment</span>`;
  commentBtn.onclick = () => {
    window.location.href = `aboutPost.html?post_id=${msg.message_id}`;
  };

  // Repost btn
  const repostBtn = document.createElement("button");
  repostBtn.className = "repostBtn media-btn";
  repostBtn.dataset.id = msg.message_id;
  repostBtn.innerHTML = `<i class="fa-solid fa-share-from-square"></i> <span>Repost</span>`;

  btnRow.appendChild(likeBtn);
  btnRow.appendChild(commentBtn);
  btnRow.appendChild(repostBtn);

  body.appendChild(btnRow);

  // Append together
  div.appendChild(header);
  div.appendChild(body);
  document.getElementById("message-container").prepend(div);

  // === Attach like toggle logic ===
  const likeIcon = likeBtn.querySelector("i");
  const likeCount = counts.querySelector(".post-like-count");
  loadLikeInfoForMessage(msg.message_id, likeIcon, likeCount);
  likeBtn.onclick = async () => {
    await toggleLikeActivityForMessage(msg.message_id, likeIcon, likeCount);
  };

  // === Dropdown click handlers ===
  dropdownMenu.querySelectorAll("a").forEach((item) => {
    item.addEventListener("click", (e) => {
      e.preventDefault();
      if (item.classList.contains("edit-option")) {
        editingMessageId = msg.message_id;
        editInput.value = msg.message;
        editToast.show();
      } else if (item.classList.contains("delete-option")) {
        deletingMessageId = msg.message_id;
        deleteToast.show();
      } else if (item.classList.contains("report-option")) {
        reportingTargetId = msg.message_id;
        reportToast.show();
      }
    });
  });
}

</script>